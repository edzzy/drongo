<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition template="cpgTemplate.xhtml">
        <ui:define name="content">
            <p:spacer height="50"/>
            <h:form id="projectsForm">
                <p:growl id="projectListMessages" showDetail="true" showSummary="true" life="3000"/>
                <p:dataTable var="project" 
                             value="#{projectsBean.projectList}" 
                             rowsPerPageTemplate="5,10,15" 
                             rowKey="#{project.id}" 
                             paginator="true" 
                             rows="10" 
                             filteredValue="#{projectsBean.filteredProjects}"  
                             id="projectsTable" 
                             emptyMessage="#{messages.label_emptyRecords}"
                             sortMode="multiple">  

                    <f:facet name="header">
                        #{messages.label_project}
                    </f:facet>

                    <p:ajax event="rowToggle" onstart="hideOtherExpendedRows();" />

                    <p:column style="width: 5px">  
                        <p:rowToggler />  
                    </p:column>

                    <p:column headerText="#{messages.project_name}"  sortBy="#{project.name}" filterBy="#{project.name}" id="name">  
                        <h:outputText value="#{project.name}"/>
                    </p:column>

                    <p:column headerText="#{messages.project_creationDate}" sortBy="#{project.created}" filterBy="#{project.created}" id="created">  
                        <h:outputText value="#{project.created}" >
                            <f:convertDateTime dateStyle="long" type="date" />
                        </h:outputText>
                    </p:column>  

                    <p:column headerText="#{messages.project_closed}" 
                              sortBy="#{project.closed}" 
                              filterBy="#{project.closed}" 
                              id="type"
                              filterOptions="#{projectsBean.projectClosedOptions}">
                        <p:graphicImage width="32" height="32" name="Primo_Icons/PNG/48x48/folder_private.png" library="images" styleClass="iconCentered" rendered="#{project.closed}"/>
                        <p:graphicImage width="32" height="32" name="Primo_Icons/PNG/48x48/folder_open.png" library="images" styleClass="iconCentered" rendered="#{not project.closed}"/>
                    </p:column>

                    <p:column style="width: 5px">
                        <p:commandLink id="editButton" action="#{projectsBean.editProject}">
                            <h:panelGroup styleClass="ui-icon ui-icon-pencil" />
                            <f:setPropertyActionListener value="#{project}" target="#{projectsBean.selectedProject}" />
                        </p:commandLink>
                        <p:tooltip for="editButton" value="#{messages.label_edit}" /> 
                    </p:column>  

                    <p:column style="width: 5px">
                        <p:commandLink id="deleteButton" oncomplete="deleteDlg.show();" update=":deleteDialog" title="#{messages.label_delete}">
                            <h:panelGroup styleClass="ui-icon ui-icon-trash" />
                            <f:setPropertyActionListener value="#{project}" target="#{projectsBean.selectedProject}" />
                        </p:commandLink>
                        <p:tooltip for="deleteButton" value="#{messages.label_delete}" /> 
                    </p:column>

                    <p:columnGroup type="footer">
                        <p:row>  
                            <p:column colspan="9" footerText="#{projectsBean.projectNumber} #{messages.label_project} : #{projectsBean.openProjectNumber} #{messages.label_opened} , #{projectsBean.closedProjectNumber} #{messages.label_closed}"  />
                        </p:row>  
                    </p:columnGroup>

                    <f:facet name="footer">
                        <p:commandButton value="#{messages.label_newProject}" icon="ui-icon-plus" action="#{projectsBean.createNewProject()}"/>
                    </f:facet>

                    <p:rowExpansion>  
                        <h:panelGrid id="expansionPanel" columns="2" cellpadding="20" style="width:auto" styleClass="topAligned">  
                            <h:outputText id="display" value="#{project.description}" escape="false" />
                        </h:panelGrid>
                    </p:rowExpansion>

                </p:dataTable>
            </h:form>

            <p:confirmDialog widgetVar="deleteDlg" id="deleteDialog" header="#{projectsBean.selectedProject.name}" message="#{messages.label_confirm_deletion}"
                             closable="false" showEffect="fade" hideEffect="explode" severity="alert" appendToBody="true" >
                <h:form id="deleteForm">
                    <h:panelGroup layout="block" style="text-align: right">
                        <p:commandButton value="#{messages.label_confirm_deletion}" actionListener="#{projectsBean.deleteProject}" update=":projectsForm:projectListMessages, :projectsForm:projectsTable" oncomplete="deleteDlg.hide();" />
                        <p:commandButton value="#{messages.label_cancel}" actionListener="#{projectsBean.cancelDeletion}" update=":projectsForm:projectListMessages" oncomplete="deleteDlg.hide();" />
                    </h:panelGroup>
                </h:form>
            </p:confirmDialog>
        </ui:define>
    </ui:composition>
</html>


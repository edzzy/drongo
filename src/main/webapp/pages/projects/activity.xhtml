<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions">
    <ui:composition template="cpgTemplate.xhtml">
        <ui:define name="content">
            <p:spacer height="50"/>

            <f:metadata>
                <f:event type="preRenderView" listener="#{activityBean.initActivities}" /> 
            </f:metadata>

            <p:tooltip />

            <o:form>
                <p:growl id="activityMessages" life="2500" showDetail="true" />

                <p:panel header="#{messages.activity_newActForApp}: #{activityBean.application.name}" >

                    <h:panelGrid columns="2">
                        <h:outputLabel for="activityType" value="#{messages.label_activity}" />
                        <p:selectOneRadio id="activityType" value="#{activityBean.selectedType}" layout="pageDirection" >  
                            <f:selectItems value="#{activityBean.availableTypes}" var="type" itemLabel="#{enums[type.label]}" itemValue="#{type}"/>  
                            <p:ajax listener="#{activityBean.onTypeChanged}" update="stepNparamPanelGrid" />
                        </p:selectOneRadio>
                    </h:panelGrid> 

                    <h:panelGrid id="stepNparamPanelGrid" columnClasses="topAlign,topAlign" columns="2">
                        <p:fieldset id="stepsFieldSet" legend="#{messages.label_stepList}" style="width: max-content" rendered="#{activityBean.selectedType != null}">
                            <h:panelGrid columns="2">
                                <p:pickList id="stepPickList" 
                                            value="#{activityBean.stepDualListModel}"
                                            var="step"
                                            showSourceFilter="true" 
                                            showTargetFilter="true" 
                                            filterMatchMode="contains"
                                            itemLabel="#{step}" 
                                            itemValue="#{step}"
                                            addAllLabel="#{messages.label_addAll}"
                                            addLabel="#{messages.label_add}"
                                            removeAllLabel="#{messages.label_removeAll}"
                                            removeLabel="#{messages.label_remove}"
                                            moveBottomLabel="#{messages.label_moveBottom}"
                                            moveDownLabel="#{messages.label_moveDown}"
                                            moveTopLabel="#{messages.label_moveTop}"
                                            moveUpLabel="#{messages.label_moveUp}"
                                            showTargetControls="true"
                                            >

                                    <o:converter converterId="omnifaces.ListConverter" list="#{activityBean.stepSource}"/>

                                    <f:facet name="sourceCaption"> #{messages.step_list}</f:facet>  
                                    <f:facet name="targetCaption"> #{messages.label_stepList}</f:facet>

                                    <p:column width="100%">  
                                        <h:outputText id="nameID" value="#{step.name}" />
                                        <p:overlayPanel id="myPanel" for="nameID" showEvent="mouseover" hideEvent="mouseout">
                                            <h:outputText value="#{step.description}" escape="false" />
                                        </p:overlayPanel> 
                                    </p:column>
                                </p:pickList>

                                <p:commandButton value="#{messages.label_newF}" icon="ui-icon-plus" action="#{activityBean.createNewStep}" ajax="false">
                                    <o:ignoreValidationFailed />
                                </p:commandButton>
                            </h:panelGrid>

                        </p:fieldset>

                        <p:fieldset id="paramsFieldSet" legend="#{messages.activity_params}" style="width: max-content" rendered="#{activityBean.selectedType != null}">

                        </p:fieldset>
                    </h:panelGrid>

                </p:panel>
            </o:form>
        </ui:define>
    </ui:composition>
</html>
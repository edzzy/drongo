<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition template="#{redirectBean.templateEquipment}">
        <ui:define name="content">
            <p:spacer height="50"/>
            <h:form id="deviceListForm">
                <p:growl id="deviceListMessages" showDetail="true" showSummary="true" life="3000"/>
                <p:dataTable var="device" 
                             value="#{devicesBean.deviceList}" 
                             rowsPerPageTemplate="5,10,15" 
                             rowKey="#{device.id}"
                             paginator="true"
                             rows="10"
                             filteredValue="#{devicesBean.filteredDevices}"
                             id="devicesTable"
                             emptyMessage="#{messages.label_emptyRecords}"
                             sortMode="multiple"
                             selection="#{devicesBean.selectedDevice}"
                             >  

                    <f:facet name="header">
                        #{messages.label_runDevice}
                    </f:facet>




                    <p:column >
                        <p:commandLink  id="showButton" action="#{devicesBean.showDevice}">
                            <p:tooltip for="showButton" value="Show" />
                            <h:panelGroup styleClass="ui-icon ui-icon-search" />
                            <f:setPropertyActionListener value="#{device}" target="#{devicesBean.selectedDevice}" />
                        </p:commandLink>
                    </p:column>

                    <p:column  style="width: 5px">  
                        <p:commandLink  id="InterventionButton" action="#{devicesBean.showDeviceInterventions()}">
                            <p:tooltip value="Interventions" for="InterventionButton" />
                            <h:panelGroup styleClass="ui-icon ui-icon-note" />
                            <f:setPropertyActionListener value="#{device}" target="#{devicesBean.selectedDevice}" />
                        </p:commandLink>
                    </p:column>

                    <p:column headerText="#{messages.equipment_name}" sortBy="#{device.name}" filterBy="#{device.name}" id="name">  
                        <h:outputText value="#{device.name}" />
                    </p:column>  

                    <p:column headerText="#{messages.equipment_manufacturer}" sortBy="#{device.manufacturer}" filterBy="#{device.manufacturer}" id="manufacturer">
                        <h:outputText value="#{device.manufacturer}" /> 
                    </p:column>

                    <p:column headerText="#{messages.equipment_type}" sortBy="#{device.modele}" filterBy="#{device.modele}" id="type">
                        <h:outputText value="#{device.modele}" />
                    </p:column>  



                    <p:column headerText="#{messages.equipment_room}" sortBy="#{device.room}" filterBy="#{device.room}" id="room">  
                        <h:outputText value="#{device.room}" />
                    </p:column>  

                    <p:column headerText="#{messages.equipment_acquisitionDate}" sortBy="#{device.acquisitionDate}" id="acquisition">
                        <h:outputText value="#{device.acquisitionDate}">
                            <f:convertDateTime dateStyle="long" type="date" pattern="yyyy" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Plateform" sortBy="#{device.plateform}" filterBy="#{device.plateform}">
                        <h:outputText value="#{device.plateform}" />
                    </p:column>
                    <p:column headerText="Status" sortBy="#{device.status}">
                        <h:outputText value="#{device.status}"  />
                    </p:column>
                    <p:column style="width: 5px">
                        <p:commandLink id="editButton" action="#{devicesBean.editDevice}">
                            <h:panelGroup styleClass="ui-icon ui-icon-pencil" />
                            <f:setPropertyActionListener value="#{device}" target="#{devicesBean.selectedDevice}" />
                        </p:commandLink>
                        <p:tooltip for="editButton" value="#{messages.label_edit}" /> 
                    </p:column>

                    <p:column style="width: 5px">
                        <p:commandLink id="deleteButton" oncomplete="deleteDlg.show();" update=":deleteDialog" title="#{messages.label_delete}">
                            <h:panelGroup styleClass="ui-icon ui-icon-trash" />
                            <f:setPropertyActionListener value="#{device}" target="#{devicesBean.selectedDevice}" />
                        </p:commandLink>
                        <p:tooltip for="deleteButton" value="#{messages.label_delete}" /> 
                    </p:column>

                    <f:facet name="footer">
                        <p:commandButton value="#{messages.equipment_newDevice}" icon="ui-icon-plus" action="#{devicesBean.createNewDevice}"/>
                    </f:facet>
                </p:dataTable>
            </h:form>

            <p:confirmDialog widgetVar="deleteDlg" id="deleteDialog" header="#{devicesBean.selectedDevice}" message="#{messages.label_confirm_deletion}"
                             closable="false" showEffect="fade" hideEffect="explode" severity="alert" appendToBody="true" >
                <h:form id="deleteForm">
                    <h:panelGroup layout="block" style="text-align: right">
                        <p:commandButton value="#{messages.label_confirm_deletion}" actionListener="#{devicesBean.deleteDevice}" update=":deviceListForm:deviceListMessages, :deviceListForm:devicesTable" oncomplete="deleteDlg.hide();" />
                        <p:commandButton value="#{messages.label_cancel}" actionListener="#{devicesBean.cancelDeletion}" update=":deviceListForm:deviceListMessages" oncomplete="deleteDlg.hide();" />
                    </h:panelGroup>
                </h:form>
            </p:confirmDialog>

        </ui:define>
    </ui:composition>
</html>